version: '3.9'

services:
  vircadia-mongodb:
    image: vircadia-mongodb:4.4
    container_name: vircadia-mongodb
    restart: unless-stopped
    hostname: vircadia-mongodb
    ports:
      - 27017:27017
    volumes:
      - ./persist-data/vircadia-mongo/data/db:/data/db
      - ./persist-data/vircadia-mongo/data/log:/var/log/mongodb
    networks:
      - vircadia

  vircadia-metaverse-server:
    image: metaverse-server:latest
    container_name: vircadia-metaverse-server
    restart: unless-stopped
    hostname: vircadia-metaverse-server
    environment:
      - IAMUS_CONFIG_FILE=/home/cadia/config/iamus.json
    volumes:
      - ./files/metaverse/iamus.json:/home/cadia/config/iamus.json
      - ./persist-data/vircadia-metaverse/metaverse/logs:/home/cadia/vircadia-metaverse/logs
      - ./persist-data/vircadia-metaverse/metaverse/Logs:/home/cadia/vircadia-metaverse/Logs
    ports:
      - 9400:9400
    links:
      - vircadia-mongodb
    networks:
      - vircadia
    depends_on:
      - vircadia-mongodb

  vircadia-metaverse-dashboard:
    image: metaverse-dashboard:latest
    container_name: vircadia-metaverse-dashboard
    restart: unless-stopped
    hostname: vircadia-metaverse-dashboard
    volumes:
      - ./persist-data/vircadia-metaverse-dashboard/logs:/home/cadia/metaverse-dashboard/log
    ports:
      - 8090:8080
    links:
      - vircadia-metaverse-server
    networks:
      - vircadia
    depends_on:
      - vircadia-metaverse-server

  vircadia-ice-server:
    image: vircadia-domain-server:latest
    container_name: vircadia-ice-server
    restart: unless-stopped
    hostname: vircadia-ice-server
    ports:
      - 7337:7337
      - 7337:7337/udp
    environment:
      - METAVERSE_URL=http://localhost:9400
    entrypoint: /home/cadia/start-ice-server.sh
    volumes:
      - ./persist-data/vircadia-ice-server/server-dotlocal/testmeteverse:/home/cadia/.local
      - ./persist-data/vircadia-ice-server/server-logs/testmeteverse:/home/cadia/logs
    networks:
      - vircadia
    depends_on:
      - vircadia-metaverse-server

  vircadia-domain-server:
    image: vircadia-domain-server:latest
    container_name: vircadia-domain-server
    restart: unless-stopped
    hostname: vircadia-domain-server
    ports:
      - 40100-40102:40100-40102
      - 40100-40102:40100-40102/udp
      - 48000-48009:48000-48009/udp
    environment:
      - METAVERSE_URL=http://localhost:9400
      - ICE_SERVER=http://localhost:7337
      - CLEANNAME=vircadia-metaverse-server
      - INSTANCE=0
    volumes:
      - ./persist-data/vircadia-domain-server/server-dotlocal/testmeteverse:/home/cadia/.local
      - ./persist-data/vircadia-domain-server/server-logs/testmeteverse:/home/cadia/logs
    networks:
      - vircadia
    depends_on:
      - vircadia-ice-server

  vircadia-web:
    image: vircadia-web:latest
    container_name: vircadia-web
    restart: unless-stopped
    hostname: vircadia-web
    ports:
      - 8080:8080
    volumes:
      - ./persist-data/vircadia-web/logs:/home/cadia/vircadia-web/log
    networks:
      - vircadia
    depends_on:
      - vircadia-domain-server

networks:
  vircadia:
    driver: bridge
